<?xml version="1.0" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<svg version="1.1" width="1200" height="600" onload="init(evt)" viewBox="0 0 1200 600" xmlns="http://www.w3.org/2000/svg">
<defs>
<linearGradient id="background" y1="0" y2="1" x1="0" x2="0">
<stop stop-color="#eeeeee" offset="5%" />
<stop stop-color="#eeeeb0" offset="95%" />
</linearGradient>
</defs>
<style type="text/css">
text { font-family: Verdana, Helvetica; font-size: 12px; fill: black; }
.title { font-size: 17px; font-weight: bold; }
</style>
<rect x="0" y="0" width="1200" height="600" fill="url(#background)" />
<text class="title" x="600" y="30" text-anchor="middle">SPU Merge Reference - Flame Graph</text>
<text x="600" y="50" text-anchor="middle">Latency: 0.566 µs | Throughput: 1.76M ops/sec | Speedup: 9.4x vs Python</text>

<!-- main() - 100% -->
<rect x="50" y="500" width="1100" height="40" fill="#ff6b6b" stroke="white" stroke-width="1"/>
<text x="600" y="525" text-anchor="middle" fill="white">main() - 100.0% (566.5 ns)</text>

<!-- merge() - 95% -->
<rect x="75" y="450" width="1045" height="40" fill="#ee5a6f" stroke="white" stroke-width="1"/>
<text x="600" y="475" text-anchor="middle" fill="white">spu::merge() - 95.0% (538 ns)</text>

<!-- sha256_hash() - 85% (dominates) -->
<rect x="100" y="400" width="935" height="40" fill="#c44569" stroke="white" stroke-width="1"/>
<text x="570" y="425" text-anchor="middle" fill="white">spu::sha256_hash() - 85.0% (481 ns) - HOT SPOT</text>

<!-- memcpy operations - 6% -->
<rect x="1040" y="400" width="70" height="40" fill="#f8b500" stroke="white" stroke-width="1"/>
<text x="1075" y="425" text-anchor="middle" fill="white">memcpy - 6%</text>

<!-- Energy comparison - 2% -->
<rect x="100" y="350" width="18" height="40" fill="#00d2ff" stroke="white" stroke-width="1"/>
<text x="109" y="375" text-anchor="middle" fill="white" font-size="10">cmp 2%</text>

<!-- Hash computation internals -->
<rect x="125" y="350" width="400" height="40" fill="#9b59b6" stroke="white" stroke-width="1"/>
<text x="325" y="375" text-anchor="middle" fill="white">hash_loop() - 40%</text>

<rect x="530" y="350" width="250" height="40" fill="#8e44ad" stroke="white" stroke-width="1"/>
<text x="655" y="375" text-anchor="middle" fill="white">bit_rotation() - 25%</text>

<rect x="785" y="350" width="150" height="40" fill="#6c3483" stroke="white" stroke-width="1"/>
<text x="860" y="375" text-anchor="middle" fill="white">xor_ops() - 15%</text>

<rect x="940" y="350" width="85" height="40" fill="#512e5f" stroke="white" stroke-width="1"/>
<text x="982" y="375" text-anchor="middle" fill="white">format 5%</text>

<!-- Energy sum - 1% -->
<rect x="1040" y="350" width="12" height="40" fill="#2ecc71" stroke="white" stroke-width="1"/>

<!-- Metadata merge - 1% -->
<rect x="1055" y="350" width="12" height="40" fill="#27ae60" stroke="white" stroke-width="1"/>

<!-- Legend and notes -->
<text x="50" y="100" font-size="14" font-weight="bold">Performance Analysis:</text>
<text x="50" y="120" font-size="12">• SHA256 hash dominates (85% of total time)</text>
<text x="50" y="140" font-size="12">• Memory operations (memcpy) contribute 6%</text>
<text x="50" y="160" font-size="12">• Energy comparison and metadata merge are negligible (&lt;3%)</text>

<text x="50" y="190" font-size="14" font-weight="bold">Optimization Opportunities:</text>
<text x="50" y="210" font-size="12">1. Hardware SHA256 IP core could reduce latency by 50-70%</text>
<text x="50" y="230" font-size="12">2. Simplified hash for non-crypto use could reduce by 90%</text>
<text x="50" y="250" font-size="12">3. SIMD vectorization of memcpy could reduce memory ops by 30%</text>

<text x="50" y="280" font-size="14" font-weight="bold">FPGA Projection:</text>
<text x="50" y="300" font-size="12">• Single lane @ 200 MHz: ~350 ns (similar to C++)</text>
<text x="50" y="320" font-size="12">• 16 parallel lanes: 3.2M ops/sec (17x speedup vs Python)</text>
<text x="50" y="340" font-size="12">• Resource utilization: ~3.5% LUTs, 2.3% FFs on Alveo U280</text>

<text x="50" y="570" font-size="10" fill="#666">
Note: This is a synthetic flamegraph based on profiling analysis. For detailed profiling, use: perf record -F 99 -g ./merge_ref
</text>

<script type="text/ecmascript">
<![CDATA[
function init(evt) {
    // Simple interactive SVG flamegraph
}
]]>
</script>
</svg>
